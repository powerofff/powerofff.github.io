<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.8.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="OpenStack多节点(Mini)该文档记录了OpenStack多节点的配置； 本次实验在**云实训平台(Zstack)完成；系统镜像：先电Centos7 **；密码为: 000000  实验目的：掌握手动的方式配置openstack平台；提高遇到故障的处理能力；削弱对脚本依赖； NOTE:: 实验没有过多的文字来描述openstack各个组件的作用，纯纯的配置过程；需要配合官方文档食用； 说明">
<meta property="og:type" content="article">
<meta property="og:title" content="So sleepy博客">
<meta property="og:url" content="http://example.com/2021/11/09/%E4%B8%89%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="So sleepy博客">
<meta property="og:description" content="OpenStack多节点(Mini)该文档记录了OpenStack多节点的配置； 本次实验在**云实训平台(Zstack)完成；系统镜像：先电Centos7 **；密码为: 000000  实验目的：掌握手动的方式配置openstack平台；提高遇到故障的处理能力；削弱对脚本依赖； NOTE:: 实验没有过多的文字来描述openstack各个组件的作用，纯纯的配置过程；需要配合官方文档食用； 说明">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-11-09T00:17:36.299Z">
<meta property="article:modified_time" content="2021-11-16T01:02:28.668Z">
<meta property="article:author" content="Sosleepy">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2021/11/09/%E4%B8%89%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2021/11/09/%E4%B8%89%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE/","path":"2021/11/09/三节点配置/","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title> | So sleepy博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">So sleepy博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">0</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">0</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">2</span></a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#OpenStack%E5%A4%9A%E8%8A%82%E7%82%B9-Mini"><span class="nav-number">1.</span> <span class="nav-text">OpenStack多节点(Mini)</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E%EF%BC%9A"><span class="nav-number">1.0.0.0.0.1.</span> <span class="nav-text">说明：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF"><span class="nav-number">1.1.</span> <span class="nav-text">基础信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84"><span class="nav-number">1.1.0.1.</span> <span class="nav-text">1. 网络架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="nav-number">1.1.0.2.</span> <span class="nav-text">2. 主机配置信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%BB%84%E4%BB%B6%E5%88%92%E5%88%86"><span class="nav-number">1.1.0.3.</span> <span class="nav-text">3. 组件划分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%AF%86%E7%A0%81%E8%A1%A8"><span class="nav-number">1.1.0.4.</span> <span class="nav-text">4. 密码表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">基础配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%94%AF%E6%92%91%E8%BD%AF%E4%BB%B6"><span class="nav-number">1.3.</span> <span class="nav-text">基础支撑软件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%EF%BC%9Achrony"><span class="nav-number">1.3.1.</span> <span class="nav-text">时间同步：chrony</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9-chrony-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">控制节点 chrony 配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E8%8A%82%E7%82%B9-chrony-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">其它节点 chrony 配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9AMariaDB"><span class="nav-number">1.3.2.</span> <span class="nav-text">数据库：MariaDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%EF%BC%9ARabbitMQ"><span class="nav-number">1.3.3.</span> <span class="nav-text">消息队列：RabbitMQ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1%EF%BC%9AMemcached"><span class="nav-number">1.3.4.</span> <span class="nav-text">缓存服务：Memcached</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenStack%E2%80%94%E2%80%94Keystone"><span class="nav-number">1.4.</span> <span class="nav-text">OpenStack——Keystone</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenStack%E2%80%94%E2%80%94Glance"><span class="nav-number">1.5.</span> <span class="nav-text">OpenStack——Glance</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenStack-%E2%80%94%E2%80%94Dashboard"><span class="nav-number">1.6.</span> <span class="nav-text">OpenStack ——Dashboard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenStack%E2%80%94%E2%80%94Nova-controller"><span class="nav-number">1.7.</span> <span class="nav-text">OpenStack——Nova-controller</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.7.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8keystone%E5%88%9B%E5%BB%BAservice%E5%92%8Cendpoints"><span class="nav-number">1.7.2.</span> <span class="nav-text">在keystone创建service和endpoints</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEnova%E6%8E%A7%E5%88%B6%E5%99%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.7.3.</span> <span class="nav-text">配置nova控制器服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEnova%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.7.4.</span> <span class="nav-text">配置nova计算服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81"><span class="nav-number">1.7.5.</span> <span class="nav-text">验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenStack%E2%80%94%E2%80%94Neutron-controller"><span class="nav-number">1.8.</span> <span class="nav-text">OpenStack——Neutron-controller</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="nav-number">1.8.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8keystone%E5%88%9B%E5%BB%BAservice%E5%92%8Cendpoints-1"><span class="nav-number">1.8.2.</span> <span class="nav-text">在keystone创建service和endpoints</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEneutron%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.8.3.</span> <span class="nav-text">配置neutron控制服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="nav-number">1.8.3.1.</span> <span class="nav-text">服务配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C-%E8%87%AA%E5%8A%A9%E6%9C%8D%E5%8A%A1%E7%BD%91%E7%BB%9C"><span class="nav-number">1.8.3.2.</span> <span class="nav-text">配置网络(自助服务网络)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.8.4.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEneutron%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.8.5.</span> <span class="nav-text">配置neutron计算服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEcinder%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.9.</span> <span class="nav-text">配置cinder控制服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEcinder%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.9.1.</span> <span class="nav-text">配置cinder计算服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEswift%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.10.</span> <span class="nav-text">配置swift控制服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEswift%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.10.1.</span> <span class="nav-text">配置swift计算服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Heat%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.11.</span> <span class="nav-text">安装Heat服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85ceilometer%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.12.</span> <span class="nav-text">安装ceilometer控制服务</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Sosleepy"
      src="/images/%E5%A4%B4%E5%83%8F.jpg">
  <p class="site-author-name" itemprop="name">Sosleepy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/09/%E4%B8%89%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="Sosleepy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So sleepy博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-09 08:17:36" itemprop="dateCreated datePublished" datetime="2021-11-09T08:17:36+08:00">2021-11-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-11-16 09:02:28" itemprop="dateModified" datetime="2021-11-16T09:02:28+08:00">2021-11-16</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="OpenStack多节点-Mini"><a href="#OpenStack多节点-Mini" class="headerlink" title="OpenStack多节点(Mini)"></a>OpenStack多节点(Mini)</h1><p>该文档记录了<code>OpenStack</code>多节点的配置；</p>
<p>本次实验在**云实训平台(Zstack)<strong>完成；系统镜像：</strong>先电Centos7 **；密码为: <strong>000000</strong> </p>
<p>实验目的：掌握<strong>手动</strong>的方式配置<code>openstack</code>平台；提高遇到<strong>故障</strong>的处理能力；削弱对脚本依赖；</p>
<p><strong>NOTE::</strong> 实验没有过多的文字来描述<code>openstack</code>各个组件的作用，纯纯的配置过程；需要配合<strong>官方文档</strong>食用；</p>
<h6 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h6><blockquote>
<p>先电镜像默认设置：</p>
<p>​    关闭selinux；</p>
<p>​    没有firewall防火墙(使用iptables[status: stop])；</p>
<p>​    没有NetworkManager </p>
<p><strong>可以忽略</strong>基础配置<strong>中的1,2,3步骤</strong></p>
</blockquote>
<h2 id="基础信息"><a href="#基础信息" class="headerlink" title="基础信息"></a>基础信息</h2><h4 id="1-网络架构"><a href="#1-网络架构" class="headerlink" title="1. 网络架构"></a>1. 网络架构</h4><p>本次实验的网络架构：<a target="_blank" rel="noopener" href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-networking.html">OpenStack官方示例架构</a></p>
<p>示例架构假设使用如下网络：</p>
<ul>
<li><p>管理者使用 172.16.202.0/24，网关 172.16.202.254</p>
<p>这个网络需要一个网关以为所有节点提供内部的管理目的的访问。</p>
</li>
<li><p>提供者网段 172.16.254.0/24，网关 172.16.202.254</p>
<p>这个网络需要一个网关来提供在环境中内部实例的访问。</p>
</li>
</ul>
<p>更多请阅读：<strong>OpenStack官方示例架构</strong></p>
<h4 id="2-主机配置信息"><a href="#2-主机配置信息" class="headerlink" title="2. 主机配置信息"></a>2. 主机配置信息</h4><table>
<thead>
<tr>
<th>角色</th>
<th>配置</th>
<th>主机名</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>控制节点</td>
<td>4C*8G</td>
<td>master.pnzx.com</td>
<td>172.16.202.249</td>
</tr>
<tr>
<td>计算节点</td>
<td>8C*16G</td>
<td>node1.pnzx.com</td>
<td>172.16.202.138</td>
</tr>
<tr>
<td>计算节点</td>
<td>8C*16G</td>
<td>node2.pnzx.com</td>
<td>172.16.202.206</td>
</tr>
</tbody></table>
<h4 id="3-组件划分"><a href="#3-组件划分" class="headerlink" title="3. 组件划分"></a>3. 组件划分</h4><ul>
<li>控制节点<ul>
<li>基础设施<ul>
<li>数据库：mysql(mariadb)</li>
<li>消息队列：rabbitmq</li>
<li>缓存：memcache</li>
<li>时间同步：chrony</li>
</ul>
</li>
<li>OpenStack组件<ul>
<li>鉴权：keystone</li>
<li>镜像：glance</li>
<li>面板：Dashboard</li>
<li>计算控制：nova-controller</li>
<li>网络控制：neutron-controller</li>
</ul>
</li>
</ul>
</li>
<li>计算节点<ul>
<li>nova-computer</li>
<li>neutron-computer</li>
</ul>
</li>
</ul>
<h4 id="4-密码表"><a href="#4-密码表" class="headerlink" title="4. 密码表"></a>4. 密码表</h4><p>所有密码使用<code>openssl rand -hex 10</code>生成</p>
<table>
<thead>
<tr>
<th>密码名称</th>
<th>密码</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>DB_PASS</td>
<td>d1840e014ad95746b31a</td>
<td>数据库的root密码</td>
</tr>
<tr>
<td>RABBIT_PASS</td>
<td>dd1c9c156c876740c5f6</td>
<td>RabbitMQ的guest用户密码</td>
</tr>
<tr>
<td>ADMIN_PASS</td>
<td>000000</td>
<td>admin用户密码</td>
</tr>
<tr>
<td>DEMO_PASS</td>
<td>000000</td>
<td>demo用户密码</td>
</tr>
<tr>
<td>KEYSTONE_DBPASS</td>
<td>830217641fc219bb3913</td>
<td>认证服务的数据库密码</td>
</tr>
<tr>
<td>GLANCE_DBPASS</td>
<td>98f96f70ef042c09b5f7</td>
<td>镜像服务的数据库密码</td>
</tr>
<tr>
<td>GLANCE_PASS</td>
<td>52079bf87c1ee2fd4a26</td>
<td>镜像服务的glance用户密码</td>
</tr>
<tr>
<td>NOVA_DBPASS</td>
<td>d97ea5e6549ffa986a24</td>
<td>计算服务的数据库密码</td>
</tr>
<tr>
<td>NOVA_PASS</td>
<td>f471d770d72f47bcf493</td>
<td>计算服务中nova用户的密码</td>
</tr>
<tr>
<td>PLACEMENT_PASS</td>
<td>f967fa8027981712e156</td>
<td>Placement服务的用户密码</td>
</tr>
<tr>
<td>NEUTRON_DBPASS</td>
<td>73d20917065afdada5fb</td>
<td>网络服务的数据库密码</td>
</tr>
<tr>
<td>NEUTRON_PASS</td>
<td>190416ac58fc7c035541</td>
<td>网络服务的 neutron用户密码</td>
</tr>
<tr>
<td>METADATA_SECRET</td>
<td>f37746cdb80fbb654f11</td>
<td></td>
</tr>
</tbody></table>
<h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><p><strong>以下所有操作均需要在所有主机上运行</strong></p>
<ol>
<li><p>关闭centos的selinux</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 永久关闭selinux</span></span><br><span class="line">sed -i <span class="string">&#x27;s/SELINUX=.*/SELINUX=permissive/g&#x27;</span> /etc/selinux/config</span><br><span class="line"><span class="comment"># 临时关闭selinux</span></span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure></li>
<li><p>关闭NetworkManager</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop NetworkManager</span><br><span class="line">systemctl <span class="built_in">disable</span> NetworkManager</span><br><span class="line">yum remove -y NetworkManager</span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure></li>
<li><p>停止firewalld 防火墙</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure></li>
<li><p>配置各个主机的主机名称</p>
<p>示例；根据实际情况更改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@172-16-202-138 ~]<span class="comment"># hostnamectl set-hostname node1.pnzx.com</span></span><br><span class="line">[root@172-16-202-138 ~]<span class="comment"># bash</span></span><br><span class="line">[root@node1 ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure></li>
<li><p>顺便备份一下，yumrepo文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d &amp;&amp; mkdir bak &amp;&amp; mv CentOS-* bak</span><br></pre></td></tr></table></figure></li>
<li><p>配置网卡，切换到<code>etc/sysconfig/network-scripts/</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制第一张网卡并改名为eth1</span></span><br><span class="line">cp ifcfg-eth0 ifcfg-eth1</span><br><span class="line"><span class="comment"># 修改eth1网卡配置文件</span></span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEVICE=eth1</span><br><span class="line">ONBOOT=yes</span><br><span class="line">TYPE=Ethernet</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>以下所有操作仅在控制节点运行即可</strong></p>
<ol start="5">
<li><p>配置每台主机的yum源</p>
<p>实训室内网yum仓库地址：172.16.254.253</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d</span><br><span class="line">vim openstack.repo</span><br></pre></td></tr></table></figure>

<p>yum配置文件参考；需要接入<code>实训室</code>云计算的网络</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[centos7]</span></span><br><span class="line"><span class="attr">name</span>=Centos7-inside</span><br><span class="line"><span class="attr">baseurl</span>=http://<span class="number">172.16</span>.<span class="number">254.253</span>/centos/<span class="number">7</span>/</span><br><span class="line"><span class="attr">enable</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[openstack]</span></span><br><span class="line"><span class="attr">name</span>=OpenStack-Queens</span><br><span class="line"><span class="attr">baseurl</span>=http://<span class="number">172.16</span>.<span class="number">254.253</span>/openstack/</span><br><span class="line"><span class="attr">enable</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>使用<code>yum repolist</code>命令检查配置是否成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master yum.repos.d]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">repo id                                               repo name                                                     status</span><br><span class="line">centos7                                               Centos7-inside                                                3,971</span><br><span class="line">openstack                                             OpenStack-Queens                                              3,230</span><br><span class="line">repolist: 7,201</span><br><span class="line">[root@master yum.repos.d]<span class="comment"># </span></span><br></pre></td></tr></table></figure></li>
<li><p>配置域名解析文件</p>
<p>编辑<code>/ect/hosts</code>文件，在文件末尾增加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.16.202.249 master.pnzx.com</span><br><span class="line">172.16.202.138 node1.pnzx.com</span><br><span class="line">172.16.202.206 node2.pnzx.com</span><br></pre></td></tr></table></figure></li>
<li><p>配置ssh免密登录</p>
<ol>
<li>在<code>控制节点</code>上使用<code>ssh-keygen -t rsa</code>配置SSH免密登录</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># ssh-keygen -t rsa</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line">/root/.ssh/id_rsa already exists.</span><br><span class="line">Overwrite (y/n)? y</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:JAuAHjRA/nv9YkoE4/zjIeI9ujg/ZqzZKiHHp/ZHUjs root@master.pnzx.com</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|==.              |</span></span><br><span class="line"><span class="string">|o...             |</span></span><br><span class="line"><span class="string">|...o. . .        |</span></span><br><span class="line"><span class="string">| .+ o..+         |</span></span><br><span class="line"><span class="string">| . + o..S        |</span></span><br><span class="line"><span class="string">|o o * E          |</span></span><br><span class="line"><span class="string">|.= = O o         |</span></span><br><span class="line"><span class="string">|=oX.= +o.        |</span></span><br><span class="line"><span class="string">|*%=+o+o ..       |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>下发公钥到其它node节点；并复制<code>控制节点</code>的yum文件个hosts文件到其它节点</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp -r /etc/yum.repos.d/openstack.repo root@node1.pnzx.com:/etc/yum.repos.d/openstack.repo</span><br><span class="line">scp -r /etc/yum.repos.d/openstack.repo root@node2.pnzx.com:/etc/yum.repos.d/openstack.repo</span><br><span class="line">scp -r /etc/hosts root@node1.pnzx.com:/etc/hosts</span><br><span class="line">scp -r /etc/hosts root@node2.pnzx.com:/etc/hosts</span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>ping</code>命令自行检查，网络是否正常</p>
<blockquote>
<p>例如：</p>
<p>master.pnzx.com -&gt; node1.pnzx.com</p>
<p>master.pnzx.com -&gt; node2.pnzx.com</p>
<p>node2.pnzx.com -&gt;  node1.pnzx.com</p>
<p>node2.pnzx.com -&gt;  master.pnzx.com</p>
</blockquote>
</li>
</ol>
<p>至此，基本的配置就已经完成了；</p>
<p>NOTE：<strong>！！！请重启所有主机！！！</strong></p>
<p>TODO：由rabbitMQ引发的锅，建议在此处重启，再继续后面的步骤；</p>
<h2 id="基础支撑软件"><a href="#基础支撑软件" class="headerlink" title="基础支撑软件"></a>基础支撑软件</h2><h3 id="时间同步：chrony"><a href="#时间同步：chrony" class="headerlink" title="时间同步：chrony"></a>时间同步：chrony</h3><p>背景：openstack要求节点个节点间的时间是同步的；</p>
<p>规划：以<code>控制节点</code>的时间为基准；所有主机均向<code>控制节点</code>同步时间；</p>
<h4 id="控制节点-chrony-配置"><a href="#控制节点-chrony-配置" class="headerlink" title="控制节点 chrony 配置"></a>控制节点 chrony 配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装软件</span></span><br><span class="line">yum install -y chrony</span><br></pre></td></tr></table></figure>

<p>编辑配置文件: <code>vim /etc/chrony.conf</code></p>
<ol>
<li><p>注释掉没用的时间服务器；增加<code>server master.pnzx.com iburst</code></p>
</li>
<li><p>授权来自<code>172.16.202.0/24</code>网段的时间同步请求：<code>allow 172.16.202.0/24</code></p>
</li>
<li><p>允许使用本地时间：<code>local stratum 10</code>，<strong>时间同步服务级别</strong></p>
</li>
<li><p>启动时间服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br><span class="line">systemctl restart chronyd</span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>chronyc sources -v</code>验证服务状态；当<code>master.pnzx.com</code>的时间服务器为<strong>^</strong>*状态时，则服务正常。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># chronyc sources -v</span></span><br><span class="line">210 Number of sources = 1</span><br><span class="line"></span><br><span class="line">  .-- Source mode  <span class="string">&#x27;^&#x27;</span> = server, <span class="string">&#x27;=&#x27;</span> = peer, <span class="string">&#x27;#&#x27;</span> = <span class="built_in">local</span> clock.</span><br><span class="line"> / .- Source state <span class="string">&#x27;*&#x27;</span> = current synced, <span class="string">&#x27;+&#x27;</span> = combined , <span class="string">&#x27;-&#x27;</span> = not combined,</span><br><span class="line">| /   <span class="string">&#x27;?&#x27;</span> = unreachable, <span class="string">&#x27;x&#x27;</span> = time may be <span class="keyword">in</span> error, <span class="string">&#x27;~&#x27;</span> = time too variable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* master.pnzx.com              10   6   377    50    +86ns[-9300ns] +/-   12us</span><br><span class="line">[root@master ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>以下为示例配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Use public servers from the pool.ntp.org project.</span><br><span class="line"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span><br><span class="line">#server 0.centos.pool.ntp.org iburst</span><br><span class="line">server master.pnzx.com iburst</span><br><span class="line">.....</span><br><span class="line"># Allow NTP client access from local network.</span><br><span class="line">allow 172.16.202.0/24</span><br><span class="line">.....</span><br><span class="line"># Serve time even if not synchronized to a time source.</span><br><span class="line">local stratum 10</span><br></pre></td></tr></table></figure>

<h4 id="其它节点-chrony-配置"><a href="#其它节点-chrony-配置" class="headerlink" title="其它节点 chrony 配置"></a>其它节点 chrony 配置</h4><p>编辑配置文件: <code>vim /etc/chrony.conf</code></p>
<ol>
<li><p>注释掉没用的时间服务器；增加<code>server master.pnzx.com iburst</code></p>
</li>
<li><p>启动时间服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br><span class="line">systemctl restart chronyd</span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>chronyc sources -v</code>验证服务状态；当<code>master.pnzx.com</code>的时间服务器为<strong>^</strong>*状态时，则服务正常。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># chronyc sources</span></span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* master.pnzx.com              11   6    77    28  +9540ns[  +14us] +/- 1212us</span><br><span class="line">[root@node1 ~]<span class="comment"># </span></span><br><span class="line"><span class="comment">#------------------------------我是分割线---------------------------------------</span></span><br><span class="line">[root@node2 ~]<span class="comment"># chronyc sources</span></span><br><span class="line">210 Number of sources = 1</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* master.pnzx.com              11   6    77    14  +3248ns[  -12us] +/- 1219us</span><br><span class="line">[root@node2 ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>以下为示例配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Use public servers from the pool.ntp.org project.</span><br><span class="line"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span><br><span class="line">#server 0.centos.pool.ntp.org iburst</span><br><span class="line">server master.pnzx.com iburst</span><br><span class="line">.....</span><br></pre></td></tr></table></figure>



<h3 id="数据库：MariaDB"><a href="#数据库：MariaDB" class="headerlink" title="数据库：MariaDB"></a>数据库：MariaDB</h3><p>大多数 OpenStack 服务使用 SQL 数据库来存储信息； <strong>运行在控制节点上</strong></p>
<ol>
<li><p>安装数据库软件包：<code>yum -y install crudini mariadb mariadb-server python2-PyMySQL</code></p>
</li>
<li><p>编辑配置文件</p>
<p>将目录切换至：<code>/etc/my.cnf.d</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成配置文件</span></span><br><span class="line">touch openstack.cnf</span><br><span class="line"><span class="comment"># 生成配置</span></span><br><span class="line">crudini --<span class="built_in">set</span> openstack.conf mysqld bind-address 172.16.202.249</span><br><span class="line">crudini --<span class="built_in">set</span> openstack.cnf mysqld default-storage-engine innodb</span><br><span class="line">crudini --<span class="built_in">set</span> openstack.cnf mysqld max_connections 4096</span><br><span class="line">crudini --<span class="built_in">set</span> openstack.cnf mysqld collation-server utf8_general_ci</span><br><span class="line">crudini --<span class="built_in">set</span> openstack.cnf mysqld character-set-server utf8</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;innodb_file_per_table&quot;</span> &gt;&gt; openstack.cnf</span><br></pre></td></tr></table></figure>

<p>配置参考：<a target="_blank" rel="noopener" href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/environment-sql-database.html">官方文档</a></p>
</li>
<li><p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> mariadb.service</span><br><span class="line">systemctl start mariadb.service</span><br></pre></td></tr></table></figure></li>
<li><p>初始化数据库</p>
<p>为了保证数据库服务的安全性，使用<code>mysql_secure_installation</code>为数据库的root用户设置一个适当的密码。</p>
</li>
<li><p> 额外的；更改mysql最大的打开文件数量和最大连接数</p>
</li>
</ol>
<p>   预防mysql被openstack打满连接导致openstack无法访问mysql</p>
<p>   参考资料：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/liufarui/p/10981492.html">调整mysql数据库最大连接数</a></p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">crudini --<span class="built_in">set</span> /usr/lib/systemd/system/mariadb.service Service LimitNOFILE 10000</span><br><span class="line">crudini --<span class="built_in">set</span> /usr/lib/systemd/system/mariadb.service Service LimitNPROC 10000</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart mariadb.service</span><br></pre></td></tr></table></figure>


<h3 id="消息队列：RabbitMQ"><a href="#消息队列：RabbitMQ" class="headerlink" title="消息队列：RabbitMQ"></a>消息队列：RabbitMQ</h3><p>OpenStack 使用MQ协调操作和各服务的状态信息； <strong>运行在控制节点上</strong></p>
<ol>
<li><p>安装软件包：<code>yum install -y rabbitmq-server</code></p>
</li>
<li><p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> rabbitmq-server.service</span><br><span class="line">systemctl start rabbitmq-server.service</span><br></pre></td></tr></table></figure></li>
<li><p>在rabbitmq为openstack添加一个用户；并授予访问权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user openstack dd1c9c156c876740c5f6</span><br><span class="line">rabbitmqctl set_permissions openstack <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>检查新添加的用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># rabbitmqctl list_users</span></span><br><span class="line">Listing users</span><br><span class="line">openstack	[]</span><br><span class="line">guest	[administrator]</span><br><span class="line">[root@master ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="缓存服务：Memcached"><a href="#缓存服务：Memcached" class="headerlink" title="缓存服务：Memcached"></a>缓存服务：Memcached</h3><p>认证服务认证缓存使用Memcached缓存令牌； <strong>运行在控制节点上</strong></p>
<ol>
<li><p>安装软件包：<code>yum install -y memcached python-memcached</code></p>
</li>
<li><p>配置开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> memcached.service</span><br><span class="line">systemctl start memcached.service</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="OpenStack——Keystone"><a href="#OpenStack——Keystone" class="headerlink" title="OpenStack——Keystone"></a>OpenStack——Keystone</h2><p>关于keystone介绍，可以阅读：<a target="_blank" rel="noopener" href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/common/get_started_identity.html">Keystone</a></p>
<ol>
<li><p>在安装身份认证访问之前，需要创建一个数据库管理员令牌(ADMIN_TOKEN)</p>
<ol>
<li><p>连接到mysql：<code>mysql -u root -p</code></p>
</li>
<li><p>创建数据库: <code>CREATE DATABASE keystone;</code></p>
</li>
<li><p>创建授权：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;830217641fc219bb3913&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;830217641fc219bb3913&#x27;;</span><br></pre></td></tr></table></figure></li>
<li><p>创建管理员令牌： <code>openssl rand -hex 10</code></p>
<p>得到令牌为：<code>0ebf08330bd64e3de490</code></p>
</li>
</ol>
</li>
</ol>
<ol start="2">
<li><p>安装和配置keystone</p>
<ol>
<li><p>安装相关组件：<code>yum install -y python-openstackclient openstack-keystone httpd mod_wsgi</code></p>
</li>
<li><p>配置keystone</p>
<p>keystone配置文件位于：<code>/etc/keystone/keystone.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crudini --<span class="built_in">set</span> /etc/keystone/keystone.conf DEFAULT admin_token 0ebf08330bd64e3de490</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/keystone/keystone.conf database connection  mysql+pymysql://keystone:830217641fc219bb3913@master.pnzx.com/keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/keystone/keystone.conf token provider fernet</span><br></pre></td></tr></table></figure></li>
<li><p>初始化keystone</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;keystone-manage db_sync&quot;</span> keystone</span><br><span class="line"><span class="comment"># 初始化Fernet keys</span></span><br><span class="line">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br></pre></td></tr></table></figure></li>
<li><p>配置Apache服务器</p>
<ol>
<li><p>编辑配置文件：/etc/httpd/conf/httpd.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s/#ServerName www.example.com:80/ServerName master.pnzx.com/g&quot;</span> /etc/httpd/conf/httpd.conf</span><br></pre></td></tr></table></figure></li>
<li><p>增加配置： <code>/etc/httpd/conf.d/wsgi-keystone.conf</code></p>
<p>TODO：/usr/share/keystone/wsgi-keystone.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">   Listen 5000</span><br><span class="line">   Listen 35357</span><br><span class="line">   </span><br><span class="line">   &lt;VirtualHost *:5000&gt;</span><br><span class="line">       WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%&#123;GROUP&#125;</span><br><span class="line">       WSGIProcessGroup keystone-public</span><br><span class="line">       WSGIScriptAlias / /usr/bin/keystone-wsgi-public</span><br><span class="line">       WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">       WSGIPassAuthorization On</span><br><span class="line">       ErrorLogFormat &quot;%&#123;cu&#125;t %M&quot;</span><br><span class="line">       ErrorLog /var/log/httpd/keystone-error.log</span><br><span class="line">       CustomLog /var/log/httpd/keystone-access.log combined</span><br><span class="line">   </span><br><span class="line">       &lt;Directory /usr/bin&gt;</span><br><span class="line">           Require all granted</span><br><span class="line">       &lt;/Directory&gt;</span><br><span class="line">   &lt;/VirtualHost&gt;</span><br><span class="line">   </span><br><span class="line">   &lt;VirtualHost *:35357&gt;</span><br><span class="line">       WSGIDaemonProcess keystone-admin processes=5 threads=1 user=keystone group=keystone display-name=%&#123;GROUP&#125;</span><br><span class="line">       WSGIProcessGroup keystone-admin</span><br><span class="line">       WSGIScriptAlias / /usr/bin/keystone-wsgi-admin</span><br><span class="line">       WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line">       WSGIPassAuthorization On</span><br><span class="line">       ErrorLogFormat &quot;%&#123;cu&#125;t %M&quot;</span><br><span class="line">       ErrorLog /var/log/httpd/keystone-error.log</span><br><span class="line">       CustomLog /var/log/httpd/keystone-access.log combined</span><br><span class="line">   </span><br><span class="line">       &lt;Directory /usr/bin&gt;</span><br><span class="line">           Require all granted</span><br><span class="line">       &lt;/Directory&gt;</span><br><span class="line">   &lt;/VirtualHost&gt;</span><br><span class="line">   </span><br><span class="line">3. 启动keystone</span><br><span class="line">   </span><br><span class="line">   ```bash</span><br><span class="line">   systemctl enable httpd.service</span><br><span class="line">   systemctl start httpd.service</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
<li><p>创建Service和endpoints</p>
<p>使用临时令牌访问keystone，用来service和注册endpoints</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OS_TOKEN=0ebf08330bd64e3de490</span><br><span class="line"><span class="built_in">export</span> OS_URL=http://master.pnzx.com:35357/v3</span><br><span class="line"><span class="built_in">export</span> OS_IDENTITY_API_VERSION=3</span><br></pre></td></tr></table></figure>

<p>创建Service：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># openstack service create --name keystone --description &quot;OpenStack Identity&quot; identity</span></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Identity               |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 90ddcfcd5b4e4988a9d5ce8e3665dc84 |</span><br><span class="line">| name        | keystone                         |</span><br><span class="line">| <span class="built_in">type</span>        | identity                         |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>创建<code>identity</code>服务对应的endpoint：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  identity public http://master.pnzx.com:5000/v3</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  identity internal http://master.pnzx.com:5000/v3</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  identity admin http://master.pnzx.com:35357/v3</span><br></pre></td></tr></table></figure></li>
<li><p>创建region、project、user and roel</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack domain create --description <span class="string">&quot;默认域&quot;</span> default</span><br><span class="line"><span class="comment">## 创建一个包含独有用户的service 项目</span></span><br><span class="line">openstack project create --domain default --description <span class="string">&quot;Service Project&quot;</span> service</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建管理员项目</span></span><br><span class="line">openstack project create --domain default --description <span class="string">&quot;管理员项目&quot;</span> admin</span><br><span class="line"><span class="comment"># 创建管理员用户</span></span><br><span class="line">openstack user create --domain default --password 000000 admin</span><br><span class="line"><span class="comment"># 创建管理员角色</span></span><br><span class="line">openstack role create admin</span><br><span class="line"><span class="comment"># 绑定admin角色到admin项目的admin用户</span></span><br><span class="line">openstack role add --project admin --user admin admin</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建普通用户</span></span><br><span class="line">openstack project create --domain default --description <span class="string">&quot;普通项目&quot;</span> demo</span><br><span class="line"><span class="comment"># 创建用户</span></span><br><span class="line">openstack user create --domain default --password 000000 demo</span><br><span class="line"><span class="comment"># 创建角色</span></span><br><span class="line">openstack role create user</span><br><span class="line">openstack role add --project demo --user demo user</span><br></pre></td></tr></table></figure></li>
<li><p> 验证</p>
</li>
</ol>
<p>   创建<code>客户端环境脚本</code>文件</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卸载临时令牌</span></span><br><span class="line"><span class="built_in">unset</span> OS_TOKEN OS_URL</span><br><span class="line">cat &gt; ~/admin-openrc.sh &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">export OS_PROJECT_DOMAIN_NAME=default</span></span><br><span class="line"><span class="string">export OS_USER_DOMAIN_NAME=default</span></span><br><span class="line"><span class="string">export OS_PROJECT_NAME=admin</span></span><br><span class="line"><span class="string">export OS_USERNAME=admin</span></span><br><span class="line"><span class="string">export OS_PASSWORD=000000</span></span><br><span class="line"><span class="string">export OS_AUTH_URL=http://master.pnzx.com:5000/v3</span></span><br><span class="line"><span class="string">export OS_IDENTITY_API_VERSION=3</span></span><br><span class="line"><span class="string">export OS_IMAGE_API_VERSION=2</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">cat &gt; ~/demo-openrc.sh &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">export OS_PROJECT_DOMAIN_NAME=default</span></span><br><span class="line"><span class="string">export OS_USER_DOMAIN_NAME=default</span></span><br><span class="line"><span class="string">export OS_PROJECT_NAME=demo</span></span><br><span class="line"><span class="string">export OS_USERNAME=demo</span></span><br><span class="line"><span class="string">export OS_PASSWORD=000000</span></span><br><span class="line"><span class="string">export OS_AUTH_URL=http://master.pnzx.com:5000/v3</span></span><br><span class="line"><span class="string">export OS_IDENTITY_API_VERSION=3</span></span><br><span class="line"><span class="string">export OS_IMAGE_API_VERSION=2</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>   测试</p>
   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># cd ~/</span></span><br><span class="line">[root@master ~]<span class="comment"># . admin-openrc.sh </span></span><br><span class="line">[root@master ~]<span class="comment"># openstack token issue</span></span><br><span class="line">........</span><br></pre></td></tr></table></figure>

<h2 id="OpenStack——Glance"><a href="#OpenStack——Glance" class="headerlink" title="OpenStack——Glance"></a>OpenStack——Glance</h2><ol>
<li><p>为glance创建数据库</p>
<ol>
<li><p>登录mysql</p>
</li>
<li><p>创建数据库：<code>CREATE DATABASE glance;</code></p>
</li>
<li><p>创建授权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON glance.* TO &#x27;glance&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;98f96f70ef042c09b5f7&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO &#x27;glance&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;98f96f70ef042c09b5f7&#x27;;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>在keystone中为glance创建<code>service</code>和<code>endpoints</code>和<code>user</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载客户端授权文件</span></span><br><span class="line"><span class="built_in">cd</span> ~/</span><br><span class="line">. admin-openrc.sh</span><br><span class="line"><span class="comment"># 创建service和endpoint</span></span><br><span class="line">openstack service create --name glance --description <span class="string">&quot;镜像服务&quot;</span> image</span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne image public http://master.pnzx.com:9292</span><br><span class="line">openstack endpoint create --region RegionOne image internal http://master.pnzx.com:9292</span><br><span class="line">openstack endpoint create --region RegionOne  image admin http://master.pnzx.com:9292</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建和绑定glance用户</span></span><br><span class="line">openstack user create --domain default --password 52079bf87c1ee2fd4a26 glance</span><br><span class="line">openstack role add --project service --user glance admin</span><br></pre></td></tr></table></figure></li>
<li><p>安装和配置glance服务</p>
<ol>
<li><p>安装软件包：<code>yum install -y openstack-glance</code></p>
</li>
<li><p>配置glance</p>
<p>配置文件位置：<code>/etc/glance/glance-api.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># database</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf database connection mysql+pymysql://glance:98f96f70ef042c09b5f7@master.pnzx.com/glance</span><br><span class="line"><span class="comment"># keystone</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken auth_uri http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken auth_url http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken memcached_servers 127.0.0.1:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken username glance</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf keystone_authtoken password 52079bf87c1ee2fd4a26</span><br><span class="line"><span class="comment"># paste_deploy</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf paste_deploy flavor keystone</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># glance 存储部分</span></span><br><span class="line"><span class="comment"># 准备将glance镜像存储在: /data/glance目录下</span></span><br><span class="line">mkdir -p /data/glance</span><br><span class="line">chown -R glance:glance /data/glance/</span><br><span class="line">[root@master ~]<span class="comment"># crudini --set /etc/glance/glance-api.conf glance_store stores file,http</span></span><br><span class="line">[root@master ~]<span class="comment"># crudini --set /etc/glance/glance-api.conf glance_store default_store file</span></span><br><span class="line">[root@master ~]<span class="comment"># crudini --set /etc/glance/glance-api.conf glance_store filesystem_store_datadir /data/glance/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑配置文件：/etc/glance/glance-registry.conf</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf database connection mysql+pymysql://glance:98f96f70ef042c09b5f7@master.pnzx.com/glance</span><br><span class="line"><span class="comment"># keystone</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken auth_uri http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken auth_url http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken memcached_servers 127.0.0.1:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken username glance</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf keystone_authtoken password 52079bf87c1ee2fd4a26</span><br><span class="line"><span class="comment"># paste_deploy</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf paste_deploy flavor keystone</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;glance-manage db_sync&quot;</span> glance</span><br></pre></td></tr></table></figure></li>
<li><p>启动和验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> openstack-glance-api.service \</span><br><span class="line">  openstack-glance-registry.service</span><br><span class="line">systemctl start openstack-glance-api.service \</span><br><span class="line">  openstack-glance-registry.service</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试上传镜像</span></span><br><span class="line">wget http://172.16.254.253/images/cirros-0.3.6-i386-disk.img</span><br><span class="line">openstack image create <span class="string">&quot;cirros-0.3.6&quot;</span> --file ~/cirros-0.3.6-i386-disk.img --disk-format qcow2 --public</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;忽略输出</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像列表</span></span><br><span class="line">[root@master ~]<span class="comment"># openstack image list</span></span><br><span class="line">+--------------------------------------+--------------+--------+</span><br><span class="line">| ID                                   | Name         | Status |</span><br><span class="line">+--------------------------------------+--------------+--------+</span><br><span class="line">| 7e4d147b-719c-4c1b-808a-c06a4102811e | cirros-0.3.6 | active |</span><br><span class="line">+--------------------------------------+--------------+--------+</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="OpenStack-——Dashboard"><a href="#OpenStack-——Dashboard" class="headerlink" title="OpenStack ——Dashboard"></a>OpenStack ——Dashboard</h2><ol>
<li><p>安装软件包：<code>yum install -y openstack-dashboard</code></p>
</li>
<li><p>修改py设置文件；参照<a target="_blank" rel="noopener" href="https://docs.openstack.org/mitaka/zh_CN/install-guide-rdo/horizon-install.html">dashboard配置</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sed -i -e <span class="string">&quot;s/^ALLOWED_HOSTS.*/ALLOWED_HOSTS = [&#x27;*&#x27;]/g&quot;</span> \</span><br><span class="line">-e <span class="string">&#x27;s/^OPENSTACK_HOST.*/OPENSTACK_HOST = &quot;master.pnzx.com&quot;/g&#x27;</span> \</span><br><span class="line">-e <span class="string">&#x27;s/#OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT.*/OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True/g&#x27;</span> \</span><br><span class="line">-e <span class="string">&#x27;s/^OPENSTACK_KEYSTONE_URL .*/OPENSTACK_KEYSTONE_URL = &quot;http:\/\/%s:5000\/v3&quot; % OPENSTACK_HOST/g&#x27;</span> \</span><br><span class="line">-e <span class="string">&#x27;s/#OPENSTACK_KEYSTONE_DEFAULT_DOMAIN.*/OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &quot;Default&quot;/g&#x27;</span> \</span><br><span class="line">-e <span class="string">&#x27;s/^OPENSTACK_KEYSTONE_DEFAULT_ROLE.*/OPENSTACK_KEYSTONE_DEFAULT_ROLE = &quot;user&quot;/g&#x27;</span> /etc/openstack-dashboard/local_settings</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;SESSION_ENGINE = &#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line"><span class="string">CACHES = &#123;</span></span><br><span class="line"><span class="string">    &#x27;default&#x27;: &#123;</span></span><br><span class="line"><span class="string">         &#x27;BACKEND&#x27;: &#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;,</span></span><br><span class="line"><span class="string">         &#x27;LOCATION&#x27;: &#x27;127.0.0.1:11211&#x27;,</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">OPENSTACK_API_VERSIONS = &#123;</span></span><br><span class="line"><span class="string">    &quot;</span>\&quot;identity<span class="string">&quot;\&quot;: 3,</span></span><br><span class="line"><span class="string">    &quot;</span>\&quot;image<span class="string">&quot;\&quot;: 2,</span></span><br><span class="line"><span class="string">    &quot;</span>\&quot;volume<span class="string">&quot;\&quot;: 2,</span></span><br><span class="line"><span class="string">&#125;&quot;</span> &gt;&gt; /etc/openstack-dashboard/local_settings</span><br></pre></td></tr></table></figure></li>
<li><p>重启服务：<code> systemctl restart httpd.service memcached.service</code></p>
</li>
<li><p>验证登录：使用浏览器打开<code>http://master.pnzx.com/dashboard</code></p>
</li>
</ol>
<h2 id="OpenStack——Nova-controller"><a href="#OpenStack——Nova-controller" class="headerlink" title="OpenStack——Nova-controller"></a>OpenStack——Nova-controller</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>使用<code>mysql -u root -p</code>登录数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE nova_api;</span><br><span class="line">CREATE DATABASE nova;</span><br><span class="line">CREATE DATABASE nova_cell0;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO &#x27;nova&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;d97ea5e6549ffa986a24&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO &#x27;nova&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;d97ea5e6549ffa986a24&#x27;;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO &#x27;nova&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;d97ea5e6549ffa986a24&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO &#x27;nova&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;d97ea5e6549ffa986a24&#x27;;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO &#x27;nova&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;d97ea5e6549ffa986a24&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO &#x27;nova&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;d97ea5e6549ffa986a24&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="在keystone创建service和endpoints"><a href="#在keystone创建service和endpoints" class="headerlink" title="在keystone创建service和endpoints"></a>在keystone创建service和endpoints</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置授权环境变量</span></span><br><span class="line">. admin-openrc.sh</span><br><span class="line"><span class="comment"># 创建nova用户</span></span><br><span class="line">openstack user create --domain default --password f471d770d72f47bcf493  nova</span><br><span class="line">openstack role add --project service --user nova admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建服务实体</span></span><br><span class="line">openstack service create --name nova --description <span class="string">&quot;计算服务&quot;</span> compute</span><br><span class="line">openstack endpoint create --region RegionOne compute public http://master.pnzx.com:8774/v2.1</span><br><span class="line">openstack endpoint create --region RegionOne compute internal http://master.pnzx.com:8774/v2.1</span><br><span class="line">openstack endpoint create --region RegionOne compute admin http://master.pnzx.com:8774/v2.1</span><br></pre></td></tr></table></figure>

<p><strong>此外，nova在14版本之后新增了Placement服务，该服务用于检查资源使用情况，需要安装在控制节点</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Placement 服务配置</span></span><br><span class="line"><span class="comment"># Placement 同样需要在keystone创建对应的账户和服务实体</span></span><br><span class="line">openstack user create --domain default --password f967fa8027981712e156 placement</span><br><span class="line">openstack role add --project service --user placement admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建placement相关API</span></span><br><span class="line">openstack service create --name placement --description <span class="string">&quot;Placement API&quot;</span> placement</span><br><span class="line">openstack endpoint create --region RegionOne placement public http://master.pnzx.com:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement internal http://master.pnzx.com:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement admin http://master.pnzx.com:8778</span><br></pre></td></tr></table></figure>

<h3 id="配置nova控制器服务"><a href="#配置nova控制器服务" class="headerlink" title="配置nova控制器服务"></a>配置nova控制器服务</h3><ol>
<li><p>安装软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openstack-nova-api openstack-nova-conductor \</span><br><span class="line">  openstack-nova-console openstack-nova-novncproxy \</span><br><span class="line">  openstack-nova-scheduler openstack-nova-placement-api</span><br></pre></td></tr></table></figure></li>
<li><p>配置服务</p>
<p>编辑配置文件：<code>/etc/nova/nova.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用 计算和元数据API</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT enabled_apis osapi_compute,metadata</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置数据库连接</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf api_database connection mysql+pymysql://nova:d97ea5e6549ffa986a24@master.pnzx.com/nova_api</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf database connection mysql+pymysql://nova:d97ea5e6549ffa986a24@master.pnzx.com/nova</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置消息队列</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT transport_url rabbit://openstack:dd1c9c156c876740c5f6@master.pnzx.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对接keystone</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf api auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_url http://master.pnzx.com:5000/v3</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken memcached_servers 127.0.0.1:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken user_domain_name default </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken username nova</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken password f471d770d72f47bcf493</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册变量</span></span><br><span class="line"><span class="comment"># 将下面的IP地址替换为控制节点的IP地址</span></span><br><span class="line"><span class="comment"># 文档描述为：主机用于连接到管理网络的IP地址</span></span><br><span class="line">LOCAL_IP=172.16.202.249</span><br><span class="line"><span class="comment"># 设置管理网络</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT my_ip <span class="variable">$LOCAL_IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用neutron服务来提供网络服务</span></span><br><span class="line"><span class="comment"># note: nova本身也提供网络服务，只不过功能简单，所以使用neutron</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT use_neutron <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置VNC代理</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc <span class="built_in">enable</span> <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc server_listen <span class="variable">$LOCAL_IP</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc server_proxyclient_address <span class="variable">$LOCAL_IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置glance</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf glance api_servers http://master.pnzx.com:9292</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置线程协调器</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置placement</span></span><br><span class="line"><span class="comment"># PLACEMENT_PASS：f967fa8027981712e156</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement os_region_name RegionOne</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement auth_url http://master.pnzx.com:5000/v3</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement username placement</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement password f967fa8027981712e156</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>由于Queens版本发版问题</strong> <a target="_blank" rel="noopener" href="https://bugzilla.redhat.com/show_bug.cgi?id=1430540">打包错误</a>我们需要改动Apache的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/httpd/conf.d/00-nova-placement-api.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;Directory /usr/bin&gt;</span></span><br><span class="line"><span class="string">        &lt;IfVersion &gt;= 2.4&gt;</span></span><br><span class="line"><span class="string">            Require all granted</span></span><br><span class="line"><span class="string">        &lt;/IfVersion&gt;</span></span><br><span class="line"><span class="string">        &lt;IfVersion &lt; 2.4&gt;</span></span><br><span class="line"><span class="string">            Order allow,deny</span></span><br><span class="line"><span class="string">            Allow from all</span></span><br><span class="line"><span class="string">        &lt;/IfVersion&gt;</span></span><br><span class="line"><span class="string">&lt;/Directory&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启httpd服务</span></span><br><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure>

<p>数据库同步</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同步nova_api数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage api_db sync&quot;</span> nova</span><br><span class="line"><span class="comment"># 注册cell0数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 map_cell0&quot;</span> nova</span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot;</span> nova</span><br><span class="line"><span class="comment"># 同步nova数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;nova-manage db sync&quot;</span> nova</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证 nova cell0 和 cell1 是否正确注册</span></span><br><span class="line">nova-manage cell_v2 list_cells</span><br></pre></td></tr></table></figure></li>
<li><p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> openstack-nova-api.service openstack-nova-consoleauth.service openstack-nova-scheduler.service openstack-nova-conductor.service openstack-nova-novncproxy.service </span><br><span class="line"></span><br><span class="line">systemctl start openstack-nova-api.service openstack-nova-consoleauth.service openstack-nova-scheduler.service openstack-nova-conductor.service openstack-nova-novncproxy.service</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="配置nova计算服务"><a href="#配置nova计算服务" class="headerlink" title="配置nova计算服务"></a>配置nova计算服务</h3><p>计算节点对接keystone时会依赖控制节点的缓存系统(memcache)，但前面的memcache使用默认配置(监听127.0.0.1)，这显然<code>计算节点</code>无法连接到<code>缓存系统</code>读取凭证；我们需要对memcache的配置做出改变：</p>
<ol>
<li><p>编辑配置文件：vim /etc/sysconfig/memcached</p>
</li>
<li><p>在<code>OPTIONS</code>中加入控制节点<code>管理网络</code>的IP地址</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PORT=&quot;11211&quot;</span><br><span class="line">USER=&quot;memcached&quot;</span><br><span class="line">MAXCONN=&quot;1024&quot;</span><br><span class="line">CACHESIZE=&quot;64&quot;</span><br><span class="line">OPTIONS=&quot;-l 127.0.0.1,::1,172.16.202.249&quot;</span><br></pre></td></tr></table></figure>

<p>修改完成后需要重启服务：<code>systemctl restart memcached.service</code></p>
</li>
<li><p>安装软件包：<code>yum install openstack-nova-compute</code></p>
</li>
<li><p>配置计算服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册变量</span></span><br><span class="line"><span class="comment"># 将下面的IP地址替换为计算节点的IP地址</span></span><br><span class="line"><span class="comment"># 文档描述为：主机用于连接到管理网络的IP地址</span></span><br><span class="line">LOCAL_IP=172.16.202.138</span><br><span class="line"><span class="comment"># 启用 计算和元数据API</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT enabled_apis osapi_compute,metadata</span><br><span class="line"><span class="comment"># 配置消息队列</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT transport_url rabbit://openstack:dd1c9c156c876740c5f6@master.pnzx.com</span><br><span class="line"><span class="comment"># 对接keystone</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf api auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_url http://master.pnzx.com:5000/v3</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken memcached_servers master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken user_domain_name default </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken username nova</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf keystone_authtoken password f471d770d72f47bcf493</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置管理网络</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT my_ip <span class="variable">$LOCAL_IP</span></span><br><span class="line"><span class="comment"># 使用neutron服务来提供网络服务</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT use_neutron <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver</span><br><span class="line"><span class="comment"># 配置VNC代理</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc <span class="built_in">enable</span> <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc server_listen <span class="variable">$LOCAL_IP</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc server_proxyclient_address <span class="variable">$LOCAL_IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># !!!增加基础url</span></span><br><span class="line"><span class="comment"># 如果用于访问远程控制台的 Web 浏览器驻留在无法解析master.pnzx.com主机名的主机上，则必须替换 master.pnzx.com为控制器节点的管理接口 IP 地址。</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf vnc novncproxy_base_url  http://master.pnzx.com:6080/vnc_auto.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置glance</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf glance api_servers http://master.pnzx.com:9292</span><br><span class="line"><span class="comment"># 配置线程协调器</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置placement</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement os_region_name RegionOne</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement auth_url http://master.pnzx.com:5000/v3</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement username placement</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf placement password f967fa8027981712e156</span><br></pre></td></tr></table></figure>

<p><strong>额外配置：</strong>选择虚拟化引擎；默认已使用KVM</p>
<p>假如我们的<code>计算节点</code>支持虚拟化功能，那么我们选择虚拟化引擎为<code>KMV</code>是一个正确的选择；</p>
<p>如果<code>计算节点</code>未开启或不支持虚拟化功能，那么我们应该选择虚拟化引擎为<code>qemu</code>；qemu=软虚拟化</p>
<p>检查命令：<code>egrep -c &#39;(vmx|svm)&#39; /proc/cpuinfo</code></p>
<p>返回有值：代表支持虚拟化；不需要执行额外配置</p>
<p>如果为0：代表不支持虚拟化；需要进行额外配置；编辑配置文件<code>/etc/nova/nova.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf libvirt virt_type qemu</span><br></pre></td></tr></table></figure></li>
<li><p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> libvirtd.service openstack-nova-compute.service</span><br><span class="line">systemctl start libvirtd.service openstack-nova-compute.service</span><br></pre></td></tr></table></figure></li>
<li><p>同步节点信息：<code>su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot; nova</code></p>
</li>
</ol>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查Placement</span></span><br><span class="line">nova-status upgrade check</span><br><span class="line"><span class="comment"># 检查运行服务</span></span><br><span class="line">openstack host list</span><br><span class="line"><span class="comment"># 检查nova服务运行状态</span></span><br><span class="line">openstack compute service list</span><br></pre></td></tr></table></figure>

<h2 id="OpenStack——Neutron-controller"><a href="#OpenStack——Neutron-controller" class="headerlink" title="OpenStack——Neutron-controller"></a>OpenStack——Neutron-controller</h2><h3 id="创建数据库-1"><a href="#创建数据库-1" class="headerlink" title="创建数据库"></a>创建数据库</h3><ol>
<li><p>登录数据库:<code>mysql -u root -p</code></p>
</li>
<li><p>配置数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE neutron;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO &#x27;neutron&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;73d20917065afdada5fb&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO &#x27;neutron&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;73d20917065afdada5fb&#x27;;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="在keystone创建service和endpoints-1"><a href="#在keystone创建service和endpoints-1" class="headerlink" title="在keystone创建service和endpoints"></a>在keystone创建service和endpoints</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">. admin-openrc.sh</span><br><span class="line"><span class="comment"># 创建账户</span></span><br><span class="line">openstack user create --domain default --password 190416ac58fc7c035541 neutron</span><br><span class="line">openstack role add --project service --user neutron admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建服务实体</span></span><br><span class="line">openstack service create --name neutron --description <span class="string">&quot;网络服务&quot;</span> network</span><br><span class="line">openstack endpoint create --region RegionOne network public http://master.pnzx.com:9696</span><br><span class="line">openstack endpoint create --region RegionOne network internal http://master.pnzx.com:9696</span><br><span class="line">openstack endpoint create --region RegionOne network admin http://master.pnzx.com:9696</span><br></pre></td></tr></table></figure>

<h3 id="配置neutron控制服务"><a href="#配置neutron控制服务" class="headerlink" title="配置neutron控制服务"></a>配置neutron控制服务</h3><p>安装软件包：<code>yum install -y openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables</code></p>
<h4 id="服务配置"><a href="#服务配置" class="headerlink" title="服务配置"></a>服务配置</h4><p>编辑配置文件:<code>/etc/neutron/neutron.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf database connection mysql+pymysql://neutron:73d20917065afdada5fb@master.pnzx.com/neutron</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择网络插件</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT core_plugin ml2</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT service_plugins router</span><br><span class="line"><span class="comment"># 允许重叠IP支持</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT allow_overlapping_ips <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置消息队列</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT transport_url rabbit://openstack:dd1c9c156c876740c5f6@master.pnzx.com</span><br><span class="line"><span class="comment"># 对接keystone</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_uri http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_url http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken memcached_servers master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken user_domain_name default </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken username neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken password 190416ac58fc7c035541</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对接nova通知</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_status_changes <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_data_changes <span class="literal">true</span></span><br><span class="line"><span class="comment"># 对接nova</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova auth_url http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova region_name RegionOne</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova username nova</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf nova password f471d770d72f47bcf493</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置线程协调器</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure>

<h4 id="配置网络-自助服务网络"><a href="#配置网络-自助服务网络" class="headerlink" title="配置网络(自助服务网络)"></a>配置网络(自助服务网络)</h4><p>编辑配置文件:<code>/etc/neutron/plugins/ml2/ml2_conf.ini</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置ml2</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 type_drivers flat,vlan,vxlan</span><br><span class="line"><span class="comment"># 开启VXLAN </span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 tenant_network_types vxlan</span><br><span class="line"><span class="comment"># 启用Linux网桥</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 mechanism_drivers linuxbridge,l2population</span><br><span class="line"><span class="comment"># 启用端口安全扩展驱动程序</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 extension_drivers port_security</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_flat flat_networks provider</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_vxlan vni_ranges 1:1000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/ml2_conf.ini securitygroup enable_ipset <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>编辑配置文件：<code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置网桥代理服务</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:eth1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置网桥代理服务(vxlan)</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan l2_population <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan local_ip <span class="variable">$LOCAL_IP</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置securitygroup</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span>: net.bridge.bridge-nf-call-ip6tables</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置L3代理</span></span><br><span class="line">crudini --<span class="built_in">set</span>  /etc/neutron/l3_agent.ini DEFAULT interface_driver linuxbridge</span><br><span class="line"><span class="comment"># 配置DHCP代理</span></span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/dhcp_agent.ini DEFAULT interface_driver linuxbridge</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/dhcp_agent.ini DEFAULT dhcp_driver neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/dhcp_agent.ini DEFAULT enable_isolated_metadata <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置元数据代理</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_host <span class="variable">$LOCAL_IP</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret f37746cdb80fbb654f11</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对接nova</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron url http://master.pnzx.com:9696 </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron auth_url http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron region_name RegionOne </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron username neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron password 190416ac58fc7c035541</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron service_metadata_proxy <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron metadata_proxy_shared_secret f37746cdb80fbb654f11</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接文件</span></span><br><span class="line">ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化数据库</span></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span> neutron</span><br><span class="line"><span class="comment"># 重启nova api服务</span></span><br><span class="line">systemctl restart openstack-nova-api.service</span><br></pre></td></tr></table></figure>

<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span><br><span class="line">systemctl start neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span><br><span class="line"><span class="comment">#L3</span></span><br><span class="line">systemctl <span class="built_in">enable</span> neutron-l3-agent.service</span><br><span class="line">systemctl start neutron-l3-agent.service</span><br></pre></td></tr></table></figure>

<h3 id="配置neutron计算服务"><a href="#配置neutron计算服务" class="headerlink" title="配置neutron计算服务"></a>配置neutron计算服务</h3><p>安装软件包：<code>yum install -y openstack-neutron-linuxbridge ebtables ipset</code></p>
<p>编辑配置文件: <code>/etc/neutron/neutron.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置网络服务</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT transport_url rabbit://openstack:dd1c9c156c876740c5f6@master.pnzx.com</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf DEFAULT auth_strategy keystone</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_uri http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_url http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken memcached_servers master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken username neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf keystone_authtoken password 190416ac58fc7c035541</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对接nova</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron url http://master.pnzx.com:9696 </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron auth_url http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron region_name RegionOne </span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron username neutron</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron password 190416ac58fc7c035541</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron service_metadata_proxy <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf neutron metadata_secret_shared f37746cdb80fbb654f11</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置计算节点网桥</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings provider:eth1</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan l2_population <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan local_ip <span class="variable">$LOCAL_IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置安全组</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group <span class="literal">true</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl restart openstack-nova-compute.service</span><br><span class="line">systemctl <span class="built_in">enable</span> neutron-linuxbridge-agent.service</span><br><span class="line">systemctl start neutron-linuxbridge-agent.service</span><br></pre></td></tr></table></figure>



<h2 id="配置cinder控制服务"><a href="#配置cinder控制服务" class="headerlink" title="配置cinder控制服务"></a>配置cinder控制服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">yum install openstack-cinder -y </span><br><span class="line">. admin-openrc.sh</span><br><span class="line">HOST_IP=172.16.202.249</span><br><span class="line"><span class="comment"># 登录数据库</span></span><br><span class="line">mysql -uroot -p000000 </span><br><span class="line"><span class="comment"># 创建数据库</span></span><br><span class="line">create database cinder;</span><br><span class="line"><span class="comment"># 给cinder库赋权</span></span><br><span class="line">GRANT ALL PRIVILEGES ON cinder.* TO <span class="string">&#x27;cinder&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON cinder.* TO <span class="string">&#x27;cinder&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line"><span class="comment"># 创建用户cinder</span></span><br><span class="line">openstack user create --domain default --password 000000 cinder</span><br><span class="line"><span class="comment"># 添加cinder用户到管理员</span></span><br><span class="line">openstack role add --project service --user cinder admin</span><br><span class="line"><span class="comment"># 创建三个卷</span></span><br><span class="line">openstack service create --name cinder  --description <span class="string">&quot;OpenStack Block Store&quot;</span> volume</span><br><span class="line">openstack service create --name cinderv2  --description <span class="string">&quot;OpenStack Block Store&quot;</span> volumev2</span><br><span class="line">openstack service create --name cinderv3  --description <span class="string">&quot;OpenStack Block Store&quot;</span> volumev3</span><br><span class="line"><span class="comment"># 创建区域卷</span></span><br><span class="line">openstack endpoint create --region RegionOne volume public http://master.pnzx.com:8776/v1/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volume internal http://master.pnzx.com:8776/v1/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volume admin http://master.pnzx.com:8776/v1/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev2 public http://master.pnzx.com:8776/v2/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev2 internal http://master.pnzx.com:8776/v2/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev2 admin http://master.pnzx.com:8776/v2/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev3 public http://master.pnzx.com:8776/v3/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev3 internal http://master.pnzx.com:8776/v3/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne volumev3 admin http://master.pnzx.com:8776/v3/%\(tenant_id\)s</span><br><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf database connection mysql+pymysql://cinder:000000@master.pnzx.com/cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT rpc_backend rabbit</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf oslo_messaging_rabbit rabbit_host master.pnzx.com</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf oslo_messaging_rabbit rabbit_userid openstack</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf oslo_messaging_rabbit rabbit_password  000000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_uri  http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_url  http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken memcached_servers master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_type  password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken project_domain_name  default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken project_name  service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken username  cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken password  000000</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT my_ip <span class="variable">$HOST_IP</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf oslo_concurrency lock_path /var/lib/cinder/tmp</span><br><span class="line"></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;cinder-manage db sync&quot;</span> cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/nova/nova.conf cinder os_region_name  RegionOne</span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl restart openstack-nova-api.service</span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-cinder-api.service openstack-cinder-scheduler.service</span><br><span class="line">systemctl start openstack-cinder-api.service openstack-cinder-scheduler.service</span><br></pre></td></tr></table></figure>

<h3 id="配置cinder计算服务"><a href="#配置cinder计算服务" class="headerlink" title="配置cinder计算服务"></a>配置cinder计算服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">yum install lvm2 device-mapper-persistent-data openstack-cinder targetcli python-keystone -y</span><br><span class="line">systemctl <span class="built_in">enable</span> lvm2-lvmetad.service</span><br><span class="line">systemctl restart lvm2-lvmetad.service</span><br><span class="line"></span><br><span class="line">pvcreate -f /dev/vdb1</span><br><span class="line">vgcreate cinder-volumes /dev/vdb1</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf database connection mysql+pymysql://cinder:000000@master.pnzx.com/cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT transport_url rabbit://openstack:000000@master.pnzx.com</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT auth_strategy keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT enabled_backends  lvm</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_uri  http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_url  http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken memcached_servers  master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken auth_type  password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken project_domain_name  default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken project_name  service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken username  cinder</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf keystone_authtoken password  000000</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT my_ip 172.16.202.253</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf lvm volume_driver cinder.volume.drivers.lvm.LVMVolumeDriver</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf lvm volume_group cinder-volumes</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf lvm iscsi_protocol iscsi</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf lvm iscsi_helper lioadm</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT glance_api_servers  http://master.pnzx.com:9292</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf oslo_concurrency lock_path /var/lib/cinder/tmp</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-cinder-volume.service target.service</span><br><span class="line">systemctl restart openstack-cinder-volume.service target.service</span><br></pre></td></tr></table></figure>

<h2 id="配置swift控制服务"><a href="#配置swift控制服务" class="headerlink" title="配置swift控制服务"></a>配置swift控制服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">yum install openstack-swift-proxy python-swiftclient python-keystoneclient python-keystonemiddleware memcached -y</span><br><span class="line"></span><br><span class="line">openstack user create --domain default --password 000000 swift</span><br><span class="line">openstack role add --project service --user swift admin</span><br><span class="line">openstack service create --name swift --description <span class="string">&quot;OpenStack Object Storage&quot;</span> object-store</span><br><span class="line">openstack endpoint create --region RegionOne object-store public http://master.pnzx.com:8080/v1/AUTH_%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne object-store internal http://master.pnzx.com:8080/v1/AUTH_%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne object-store admin http://master.pnzx.com:8080/v1</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;<span class="string">EOF &gt; /etc/swift/proxy-server.conf</span></span><br><span class="line"><span class="string">[DEFAULT]</span></span><br><span class="line"><span class="string">bind_port = 8080</span></span><br><span class="line"><span class="string">swift_dir = /etc/swift</span></span><br><span class="line"><span class="string">user = swift</span></span><br><span class="line"><span class="string">[pipeline:main]</span></span><br><span class="line"><span class="string">pipeline = catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit authtoken keystoneauth container-quotas account-quotas slo dlo versioned_writes proxy-logging proxy-server</span></span><br><span class="line"><span class="string">[app:proxy-server]</span></span><br><span class="line"><span class="string">use = egg:swift#proxy</span></span><br><span class="line"><span class="string">account_autocreate = True</span></span><br><span class="line"><span class="string">[filter:tempauth]</span></span><br><span class="line"><span class="string">use = egg:swift#tempauth</span></span><br><span class="line"><span class="string">user_admin_admin = admin .admin .reseller_admin</span></span><br><span class="line"><span class="string">user_test_tester = testing .admin</span></span><br><span class="line"><span class="string">user_test2_tester2 = testing2 .admin</span></span><br><span class="line"><span class="string">user_test_tester3 = testing3</span></span><br><span class="line"><span class="string">user_test5_tester5 = testing5 service</span></span><br><span class="line"><span class="string">[filter:authtoken]</span></span><br><span class="line"><span class="string">paste.filter_factory = keystonemiddleware.auth_token:filter_factory</span></span><br><span class="line"><span class="string">auth_uri = http://master.pnzx.com:5000</span></span><br><span class="line"><span class="string">auth_url = http://master.pnzx.com:35357</span></span><br><span class="line"><span class="string">memcached_servers = master.pnzx.com:11211</span></span><br><span class="line"><span class="string">auth_type = password</span></span><br><span class="line"><span class="string">project_domain_name = default</span></span><br><span class="line"><span class="string">user_domain_name = default</span></span><br><span class="line"><span class="string">project_name = service</span></span><br><span class="line"><span class="string">username = swift</span></span><br><span class="line"><span class="string">password = 000000</span></span><br><span class="line"><span class="string">delay_auth_decision = True</span></span><br><span class="line"><span class="string">[filter:keystoneauth]</span></span><br><span class="line"><span class="string">use = egg:swift#keystoneauth</span></span><br><span class="line"><span class="string">operator_roles = admin,user</span></span><br><span class="line"><span class="string">[filter:healthcheck]</span></span><br><span class="line"><span class="string">use = egg:swift#healthcheck</span></span><br><span class="line"><span class="string">[filter:cache]</span></span><br><span class="line"><span class="string">memcache_servers = master.pnzx.com:11211</span></span><br><span class="line"><span class="string">use = egg:swift#memcache</span></span><br><span class="line"><span class="string">[filter:ratelimit]</span></span><br><span class="line"><span class="string">use = egg:swift#ratelimit</span></span><br><span class="line"><span class="string">[filter:domain_remap]</span></span><br><span class="line"><span class="string">use = egg:swift#domain_remap</span></span><br><span class="line"><span class="string">[filter:catch_errors]</span></span><br><span class="line"><span class="string">use = egg:swift#catch_errors</span></span><br><span class="line"><span class="string">[filter:cname_lookup]</span></span><br><span class="line"><span class="string">use = egg:swift#cname_lookup</span></span><br><span class="line"><span class="string">[filter:staticweb]</span></span><br><span class="line"><span class="string">use = egg:swift#staticweb</span></span><br><span class="line"><span class="string">[filter:tempurl]</span></span><br><span class="line"><span class="string">use = egg:swift#tempurl</span></span><br><span class="line"><span class="string">[filter:formpost]</span></span><br><span class="line"><span class="string">use = egg:swift#formpost</span></span><br><span class="line"><span class="string">[filter:name_check]</span></span><br><span class="line"><span class="string">use = egg:swift#name_check</span></span><br><span class="line"><span class="string">[filter:list-endpoints]</span></span><br><span class="line"><span class="string">use = egg:swift#list_endpoints</span></span><br><span class="line"><span class="string">[filter:proxy-logging]</span></span><br><span class="line"><span class="string">use = egg:swift#proxy_logging</span></span><br><span class="line"><span class="string">[filter:bulk]</span></span><br><span class="line"><span class="string">use = egg:swift#bulk</span></span><br><span class="line"><span class="string">[filter:slo]</span></span><br><span class="line"><span class="string">use = egg:swift#slo</span></span><br><span class="line"><span class="string">[filter:dlo]</span></span><br><span class="line"><span class="string">use = egg:swift#dlo</span></span><br><span class="line"><span class="string">[filter:container-quotas]</span></span><br><span class="line"><span class="string">use = egg:swift#container_quotas</span></span><br><span class="line"><span class="string">[filter:account-quotas]</span></span><br><span class="line"><span class="string">use = egg:swift#account_quotas</span></span><br><span class="line"><span class="string">[filter:gatekeeper]</span></span><br><span class="line"><span class="string">use = egg:swift#gatekeeper</span></span><br><span class="line"><span class="string">[filter:container_sync]</span></span><br><span class="line"><span class="string">use = egg:swift#container_sync</span></span><br><span class="line"><span class="string">[filter:xprofile]</span></span><br><span class="line"><span class="string">use = egg:swift#xprofile</span></span><br><span class="line"><span class="string">[filter:versioned_writes]</span></span><br><span class="line"><span class="string">use = egg:swift#versioned_writes</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">pushd</span> /etc/swift</span><br><span class="line">swift-ring-builder account.builder create 18 1 1</span><br><span class="line">swift-ring-builder account.builder add --region 1 --zone 1 --ip 172.16.202.124 --port 6002 --device vdb2 --weight 100</span><br><span class="line">swift-ring-builder account.builder</span><br><span class="line">swift-ring-builder account.builder rebalance</span><br><span class="line"></span><br><span class="line">swift-ring-builder container.builder create 10 1 1</span><br><span class="line">swift-ring-builder container.builder add --region 1 --zone 1 --ip 172.16.202.124 --port 6001 --device vdb2 --weight 100</span><br><span class="line">swift-ring-builder container.builder</span><br><span class="line">swift-ring-builder container.builder rebalance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">swift-ring-builder object.builder create 10 1 1</span><br><span class="line">swift-ring-builder object.builder  add --region 1 --zone 1 --ip 172.16.202.124 --port 6000 --device vdb2 --weight 100  </span><br><span class="line">swift-ring-builder object.builder</span><br><span class="line">swift-ring-builder object.builder rebalance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">popd</span></span><br><span class="line"><span class="comment">#---------------</span></span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt; /etc/swift/swift.conf</span></span><br><span class="line"><span class="string">[swift-hash]</span></span><br><span class="line"><span class="string">swift_hash_path_suffix = changeme</span></span><br><span class="line"><span class="string">swift_hash_path_prefix = changeme</span></span><br><span class="line"><span class="string">[storage-policy:0]</span></span><br><span class="line"><span class="string">name = Policy-0</span></span><br><span class="line"><span class="string">default = yes</span></span><br><span class="line"><span class="string">aliases = yellow, orange</span></span><br><span class="line"><span class="string">[swift-constraints]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chown -R root:swift /etc/swift</span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-swift-proxy.service memcached.service</span><br><span class="line">systemctl restart openstack-swift-proxy.service memcached.service</span><br></pre></td></tr></table></figure>

<h3 id="配置swift计算服务"><a href="#配置swift计算服务" class="headerlink" title="配置swift计算服务"></a>配置swift计算服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">yum install xfsprogs rsync openstack-swift-account openstack-swift-container openstack-swift-object -y</span><br><span class="line">mkfs.xfs -i size=1024 -f /dev/vdb2</span><br><span class="line">sed -i <span class="string">&#x27;/nodiratime/d&#x27;</span> /etc/fstab</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/dev/vdb2 /swift/node/vdb2 xfs loop,noatime,nodiratime,nobarrier,logbufs=8 0 2&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line">mkdir -p /swift/node/vdb2</span><br><span class="line">mount /dev/vdb2 /swift/node/vdb2</span><br><span class="line">scp master.pnzx.com:/etc/swift/*.ring.gz /etc/swift/</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;<span class="string">EOF &gt; /etc/rsyncd.conf</span></span><br><span class="line"><span class="string">pid file = /var/run/rsyncd.pid</span></span><br><span class="line"><span class="string">log file = /var/log/rsyncd.log</span></span><br><span class="line"><span class="string">uid = swift</span></span><br><span class="line"><span class="string">gid = swift</span></span><br><span class="line"><span class="string">address = 127.0.0.1</span></span><br><span class="line"><span class="string">[account]</span></span><br><span class="line"><span class="string">path            = /swift/node</span></span><br><span class="line"><span class="string">read only       = false</span></span><br><span class="line"><span class="string">write only      = no</span></span><br><span class="line"><span class="string">list            = yes</span></span><br><span class="line"><span class="string">incoming chmod  = 0644</span></span><br><span class="line"><span class="string">outgoing chmod  = 0644</span></span><br><span class="line"><span class="string">max connections = 25</span></span><br><span class="line"><span class="string">lock file =     /var/lock/account.lock</span></span><br><span class="line"><span class="string">[container]</span></span><br><span class="line"><span class="string">path            = /swift/node</span></span><br><span class="line"><span class="string">read only       = false</span></span><br><span class="line"><span class="string">write only      = no</span></span><br><span class="line"><span class="string">list            = yes</span></span><br><span class="line"><span class="string">incoming chmod  = 0644</span></span><br><span class="line"><span class="string">outgoing chmod  = 0644</span></span><br><span class="line"><span class="string">max connections = 25</span></span><br><span class="line"><span class="string">lock file =     /var/lock/container.lock</span></span><br><span class="line"><span class="string">[object]</span></span><br><span class="line"><span class="string">path            = /swift/node</span></span><br><span class="line"><span class="string">read only       = false</span></span><br><span class="line"><span class="string">write only      = no</span></span><br><span class="line"><span class="string">list            = yes</span></span><br><span class="line"><span class="string">incoming chmod  = 0644</span></span><br><span class="line"><span class="string">outgoing chmod  = 0644</span></span><br><span class="line"><span class="string">max connections = 25</span></span><br><span class="line"><span class="string">lock file =     /var/lock/object.lock</span></span><br><span class="line"><span class="string">[swift_server]</span></span><br><span class="line"><span class="string">path            = /etc/swift</span></span><br><span class="line"><span class="string">read only       = true</span></span><br><span class="line"><span class="string">write only      = no</span></span><br><span class="line"><span class="string">list            = yes</span></span><br><span class="line"><span class="string">incoming chmod  = 0644</span></span><br><span class="line"><span class="string">outgoing chmod  = 0644</span></span><br><span class="line"><span class="string">max connections = 5</span></span><br><span class="line"><span class="string">lock file =     /var/lock/swift_server.lock</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> rsyncd.service</span><br><span class="line">systemctl restart rsyncd.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;<span class="string">EOF &gt; /etc/swift/account-server.conf</span></span><br><span class="line"><span class="string">[DEFAULT]</span></span><br><span class="line"><span class="string">bind_port = 6002</span></span><br><span class="line"><span class="string">user = swift</span></span><br><span class="line"><span class="string">swift_dir = /etc/swift</span></span><br><span class="line"><span class="string">devices = /swift/node</span></span><br><span class="line"><span class="string">mount_check = false</span></span><br><span class="line"><span class="string">[pipeline:main]</span></span><br><span class="line"><span class="string">pipeline = healthcheck recon account-server</span></span><br><span class="line"><span class="string">[app:account-server]</span></span><br><span class="line"><span class="string">use = egg:swift#account</span></span><br><span class="line"><span class="string">[filter:healthcheck]</span></span><br><span class="line"><span class="string">use = egg:swift#healthcheck</span></span><br><span class="line"><span class="string">[filter:recon]</span></span><br><span class="line"><span class="string">use = egg:swift#recon</span></span><br><span class="line"><span class="string">recon_cache_path = /var/cache/swift</span></span><br><span class="line"><span class="string">[account-replicator]</span></span><br><span class="line"><span class="string">[account-auditor]</span></span><br><span class="line"><span class="string">[account-reaper]</span></span><br><span class="line"><span class="string">[filter:xprofile]</span></span><br><span class="line"><span class="string">use = egg:swift#xprofile</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;<span class="string">EOF &gt; /etc/swift/container-server.conf</span></span><br><span class="line"><span class="string">[DEFAULT]</span></span><br><span class="line"><span class="string">bind_port = 6001</span></span><br><span class="line"><span class="string">user = swift</span></span><br><span class="line"><span class="string">swift_dir = /etc/swift</span></span><br><span class="line"><span class="string">devices = /swift/node</span></span><br><span class="line"><span class="string">mount_check = false</span></span><br><span class="line"><span class="string">[pipeline:main]</span></span><br><span class="line"><span class="string">pipeline = healthcheck recon container-server</span></span><br><span class="line"><span class="string">[app:container-server]</span></span><br><span class="line"><span class="string">use = egg:swift#container</span></span><br><span class="line"><span class="string">[filter:healthcheck]</span></span><br><span class="line"><span class="string">use = egg:swift#healthcheck</span></span><br><span class="line"><span class="string">[filter:recon]</span></span><br><span class="line"><span class="string">use = egg:swift#recon</span></span><br><span class="line"><span class="string">recon_cache_path = /var/cache/swift</span></span><br><span class="line"><span class="string">[container-replicator]</span></span><br><span class="line"><span class="string">[container-updater]</span></span><br><span class="line"><span class="string">[container-auditor]</span></span><br><span class="line"><span class="string">[container-sync]</span></span><br><span class="line"><span class="string">[filter:xprofile]</span></span><br><span class="line"><span class="string">use = egg:swift#xprofile</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;<span class="string">EOF &gt; /etc/swift/object-server.conf</span></span><br><span class="line"><span class="string">[DEFAULT]</span></span><br><span class="line"><span class="string">bind_port = 6000</span></span><br><span class="line"><span class="string">user = swift</span></span><br><span class="line"><span class="string">swift_dir = /etc/swift</span></span><br><span class="line"><span class="string">devices = /swift/node</span></span><br><span class="line"><span class="string">mount_check = false</span></span><br><span class="line"><span class="string">[pipeline:main]</span></span><br><span class="line"><span class="string">pipeline = healthcheck recon object-server</span></span><br><span class="line"><span class="string">[app:object-server]</span></span><br><span class="line"><span class="string">use = egg:swift#object</span></span><br><span class="line"><span class="string">[filter:healthcheck]</span></span><br><span class="line"><span class="string">use = egg:swift#healthcheck</span></span><br><span class="line"><span class="string">[filter:recon]</span></span><br><span class="line"><span class="string">use = egg:swift#recon</span></span><br><span class="line"><span class="string">recon_cache_path = /var/cache/swift</span></span><br><span class="line"><span class="string">recon_lock_path = /var/lock</span></span><br><span class="line"><span class="string">[object-replicator]</span></span><br><span class="line"><span class="string">[object-reconstructor]</span></span><br><span class="line"><span class="string">[object-updater]</span></span><br><span class="line"><span class="string">[object-auditor]</span></span><br><span class="line"><span class="string">[filter:xprofile]</span></span><br><span class="line"><span class="string">use = egg:swift#xprofile</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt;&lt;<span class="string">EOF &gt; /etc/swift/swift.conf</span></span><br><span class="line"><span class="string">[swift-hash]</span></span><br><span class="line"><span class="string">swift_hash_path_suffix = changeme</span></span><br><span class="line"><span class="string">swift_hash_path_prefix = changeme</span></span><br><span class="line"><span class="string">[storage-policy:0]</span></span><br><span class="line"><span class="string">name = Policy-0</span></span><br><span class="line"><span class="string">default = yes</span></span><br><span class="line"><span class="string">aliases = yellow, orange</span></span><br><span class="line"><span class="string">[swift-constraints]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">chown -R swift:swift /swift/node</span><br><span class="line">mkdir -p /var/cache/swift</span><br><span class="line">chown -R root:swift /var/cache/swift</span><br><span class="line">chmod -R 775 /var/cache/swift</span><br><span class="line">chown -R root:swift /etc/swift</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-swift-account.service openstack-swift-account-auditor.service openstack-swift-account-reaper.service openstack-swift-account-replicator.service</span><br><span class="line">systemctl restart openstack-swift-account.service openstack-swift-account-auditor.service openstack-swift-account-reaper.service openstack-swift-account-replicator.service</span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-swift-container.service openstack-swift-container-auditor.service openstack-swift-container-replicator.service openstack-swift-container-updater.service</span><br><span class="line">systemctl restart openstack-swift-container.service openstack-swift-container-auditor.service openstack-swift-container-replicator.service openstack-swift-container-updater.service</span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-swift-object.service openstack-swift-object-auditor.service openstack-swift-object-replicator.service openstack-swift-object-updater.service</span><br><span class="line">systemctl restart openstack-swift-object.service openstack-swift-object-auditor.service openstack-swift-object-replicator.service openstack-swift-object-updater.service</span><br></pre></td></tr></table></figure>

<h2 id="安装Heat服务"><a href="#安装Heat服务" class="headerlink" title="安装Heat服务"></a>安装Heat服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p 000000 <span class="string">&quot;create database IF NOT EXISTS heat ;&quot;</span></span><br><span class="line">mysql -uroot -p 000000 <span class="string">&quot;GRANT ALL PRIVILEGES ON heat.* TO &#x27;heat&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;000000&#x27;;&quot;</span></span><br><span class="line">mysql -uroot -p 000000 <span class="string">&quot;GRANT ALL PRIVILEGES ON heat.* TO &#x27;heat&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;000000&#x27;&quot;</span></span><br><span class="line">yum install openstack-heat-api openstack-heat-api-cfn openstack-heat-engine openstack-heat-ui -y</span><br><span class="line">openstack user create --domain default --password 000000 heat</span><br><span class="line">openstack role add --project service --user heat admin</span><br><span class="line">openstack service create --name heat --description <span class="string">&quot;Orchestration&quot;</span> orchestration</span><br><span class="line">openstack service create --name heat-cfn --description <span class="string">&quot;Orchestration&quot;</span>  cloudformation </span><br><span class="line">openstack endpoint create --region RegionOne orchestration public http://master.pnzx.com:8004/v1/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne orchestration internal http://master.pnzx.com:8004/v1/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne orchestration admin http://master.pnzx.com:8004/v1/%\(tenant_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne cloudformation public http://master.pnzx.com:8000/v1</span><br><span class="line">openstack endpoint create --region RegionOne cloudformation internal http://master.pnzx.com:8000/v1</span><br><span class="line">openstack endpoint create --region RegionOne cloudformation admin http://master.pnzx.com:8000/v1</span><br><span class="line">openstack domain create --description <span class="string">&quot;Stack projects and users&quot;</span> heat</span><br><span class="line">openstack user create --domain heat  --password 000000 heat_domain_admin</span><br><span class="line">openstack role add --domain heat --user-domain heat --user heat_domain_admin admin</span><br><span class="line">openstack role create heat_stack_owner</span><br><span class="line">openstack role add --project demo --user demo heat_stack_owner</span><br><span class="line">openstack role create heat_stack_user</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf database connection mysql+pymysql://heat:000000@master.pnzx.com/heat</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf DEFAULT transport_url rabbit://openstack:000000@master.pnzx.com</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken auth_uri  http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken auth_url  http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken memcached_servers  master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken auth_type  password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken project_domain_name  default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken project_name  service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken username  heat</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf keystone_authtoken password  000000</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf trustee auth_plugin password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf trustee auth_url http://master.pnzx.com:35357</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf trustee username heat</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf trustee password 000000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf trustee user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf clients_keystone auth_uri http://master.pnzx.com:35357</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf DEFAULT heat_metadata_server_url http://master.pnzx.com:8000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf DEFAULT heat_waitcondition_server_url http://master.pnzx.com:8000/v1/waitcondition</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf DEFAULT stack_domain_admin heat_domain_admin</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf DEFAULT stack_domain_admin_password 000000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf DEFAULT stack_user_domain_name heat</span><br><span class="line"></span><br><span class="line">su -s /bin/sh -c <span class="string">&quot;heat-manage db_sync&quot;</span> heat</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-heat-api.service openstack-heat-api-cfn.service openstack-heat-engine.service</span><br><span class="line">systemctl restart openstack-heat-api.service openstack-heat-api-cfn.service openstack-heat-engine.service</span><br><span class="line">systemctl restart httpd memcached</span><br></pre></td></tr></table></figure>

<h2 id="安装ceilometer控制服务"><a href="#安装ceilometer控制服务" class="headerlink" title="安装ceilometer控制服务"></a>安装ceilometer控制服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">. ~/admin-openrc.sh</span><br><span class="line">yum install openstack-gnocchi-api openstack-gnocchi-metricd python2-gnocchiclient openstack-ceilometer-notification openstack-ceilometer-central python2-ceilometerclient python-ceilometermiddleware -y</span><br><span class="line"></span><br><span class="line">openstack user create --domain default --password 000000 ceilometer</span><br><span class="line">openstack role add --project service --user ceilometer admin</span><br><span class="line">openstack service create --name ceilometer --description <span class="string">&quot;OpenStack Telemetry Service&quot;</span> metering </span><br><span class="line">openstack user create --domain default --password 000000 gnocchi</span><br><span class="line">openstack role add --project service --user gnocchi admin</span><br><span class="line">openstack service create --name gnocchi --description <span class="string">&quot;Metric Service&quot;</span> metric</span><br><span class="line">openstack endpoint create --region RegionOne metric public http://master.pnzx.com:8041</span><br><span class="line">openstack endpoint create --region RegionOne metric internal http://master.pnzx.com:8041</span><br><span class="line">openstack endpoint create --region RegionOne metric admin http://master.pnzx.com:8041</span><br><span class="line"></span><br><span class="line">openstack role create ResellerAdmin</span><br><span class="line">openstack role add --project service --user ceilometer ResellerAdmin</span><br><span class="line"></span><br><span class="line">mysql -uroot -p000000 <span class="string">&quot;create database IF NOT EXISTS gnocchi ;&quot;</span></span><br><span class="line">mysql -uroot -p000000 <span class="string">&quot;GRANT ALL PRIVILEGES ON gnocchi.* TO &#x27;gnocchi&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;000000&#x27; ;&quot;</span></span><br><span class="line">mysql -uroot -p000000 <span class="string">&quot;GRANT ALL PRIVILEGES ON gnocchi.* TO &#x27;gnocchi&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;000000&#x27; ;&quot;</span></span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf DEFAULT log_dir /var/<span class="built_in">log</span>/gnocchi</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf api auth_mode keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf database backend sqlalchemy</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken www_authenticate_uri http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken auth_url http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken memcached_servers master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken username gnocchi</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken password 000000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf keystone_authtoken service_token_roles_required <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf indexer url mysql+pymysql://gnocchi:000000@master.pnzx.com/gnocchi</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf storage file_basepath /var/lib/gnocchi</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/gnocchi/gnocchi.conf storage driver file</span><br><span class="line"></span><br><span class="line">cat &gt;/etc/httpd/conf.d/10-gnocchi_wsgi.conf&lt;&lt;- <span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Listen 8041</span></span><br><span class="line"><span class="string">&lt;VirtualHost *:8041&gt;</span></span><br><span class="line"><span class="string">  DocumentRoot /var/www/cgi-bin/gnocchi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;Directory /var/www/cgi-bin/gnocchi&gt;</span></span><br><span class="line"><span class="string">    AllowOverride None</span></span><br><span class="line"><span class="string">    Require all granted</span></span><br><span class="line"><span class="string">  &lt;/Directory&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  CustomLog /var/log/httpd/gnocchi_wsgi_access.log combined</span></span><br><span class="line"><span class="string">  ErrorLog /var/log/httpd/gnocchi_wsgi_error.log</span></span><br><span class="line"><span class="string">  SetEnvIf X-Forwarded-Proto https HTTPS=1</span></span><br><span class="line"><span class="string">  WSGIApplicationGroup %&#123;GLOBAL&#125;</span></span><br><span class="line"><span class="string">  WSGIDaemonProcess gnocchi display-name=gnocchi_wsgi user=gnocchi group=gnocchi processes=6 threads=6</span></span><br><span class="line"><span class="string">  WSGIProcessGroup gnocchi</span></span><br><span class="line"><span class="string">  WSGIScriptAlias / /var/www/cgi-bin/gnocchi/app</span></span><br><span class="line"><span class="string">&lt;/VirtualHost&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir /var/www/cgi-bin/gnocchi</span><br><span class="line">cp /usr/lib/python2.7/site-packages/gnocchi/rest/gnocchi-api /var/www/cgi-bin/gnocchi/app</span><br><span class="line">chown -R gnocchi. /var/www/cgi-bin/gnocchi </span><br><span class="line">su -s /bin/bash gnocchi -c <span class="string">&quot;gnocchi-upgrade&quot;</span></span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-gnocchi-api.service openstack-gnocchi-metricd.service</span><br><span class="line">systemctl restart openstack-gnocchi-api.service openstack-gnocchi-metricd.service</span><br><span class="line">systemctl restart httpd memcached</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export OS_AUTH_TYPE=password&quot;</span> &gt;&gt; /etc/keystone/admin-openrc.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export OS_AUTH_TYPE=password&quot;</span> &gt;&gt; /etc/keystone/demo-openrc.sh</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf DEFAULT transport_url rabbit://openstack:000000@master.pnzx.com</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf api auth_mode keystone</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf dispatcher_gnocchi filter_service_activity False</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken www_authenticate_uri = http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken auth_url = http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken memcached_servers = master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken auth_type = password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken project_domain_name = default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken user_domain_name = default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken project_name = service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken username = gnocchi</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf keystone_authtoken password = 000000</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf service_credentials auth_type password</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf service_credentials auth_url http://master.pnzx.com:5000</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf service_credentials memcached_servers master.pnzx.com:11211</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf service_credentials project_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf service_credentials user_domain_name default</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf service_credentials project_name service</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf service_credentials username ceilometer</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/ceilometer/ceilometer.conf service_credentials password 000000</span><br><span class="line"></span><br><span class="line">su -s /bin/bash ceilometer -c <span class="string">&quot;ceilometer-upgrade --skip-metering-database&quot;</span> </span><br><span class="line">systemctl <span class="built_in">enable</span> openstack-ceilometer-notification.service openstack-ceilometer-central.service</span><br><span class="line">systemctl restart openstack-ceilometer-notification.service openstack-ceilometer-central.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf DEFAULT transport_url rabbit://openstack:000000@master.pnzx.com</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-api.conf oslo_messaging_notifications driver messagingv2</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf DEFAULT transport_url rabbit://openstack:000000@master.pnzx.com</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/glance/glance-registry.conf oslo_messaging_notifications driver messagingv2</span><br><span class="line"></span><br><span class="line">systemctl restart openstack-glance-api openstack-glance-registry </span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf DEFAULT transport_url rabbit:/openstack:000000@master.pnzx.com</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/cinder/cinder.conf oslo_messaging_notifications driver messagingv2</span><br><span class="line"></span><br><span class="line">systemctl restart openstack-cinder-api openstack-cinder-scheduler </span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf oslo_messaging_notifications driver messagingv2</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/heat/heat.conf DEFAULT transport_url rabbit://openstack:000000@master.pnzx.com</span><br><span class="line">systemctl restart openstack-heat-api.service openstack-heat-api-cfn.service openstack-heat-engine.service</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/neutron/neutron.conf oslo_messaging_notifications driver messagingv2</span><br><span class="line">systemctl restart neutron-server.service</span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/swift/proxy-server.conf  filter:keystoneauth operator_roles <span class="string">&quot;admin, user, ResellerAdmin&quot;</span></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/swift/proxy-server.conf pipeline:main pipeline <span class="string">&quot;catch_errors gatekeeper healthcheck proxy-logging cache container_sync bulk ratelimit authtoken keystoneauth container-quotas account-quotas slo dlo versioned_writes proxy-logging ceilometer proxy-server&quot;</span></span><br><span class="line"></span><br><span class="line">crudini --<span class="built_in">set</span> /etc/swift/proxy-server.conf filter:ceilometer paste.filter_factory ceilometermiddleware.swift:filter_factory</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/swift/proxy-server.conf filter:ceilometer url  rabbit://openstack:000000@master.pnzx.com:5672/</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/swift/proxy-server.conf filter:ceilometer driver  messagingv2</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/swift/proxy-server.conf filter:ceilometer topic  notifications</span><br><span class="line">crudini --<span class="built_in">set</span> /etc/swift/proxy-server.conf filter:ceilometer log_level  WARN</span><br><span class="line"></span><br><span class="line">systemctl restart openstack-swift-proxy.service</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
            </div>
            <div class="post-nav-item">
                <a href="/2021/11/16/hello-world/" rel="next" title="Hello World">
                  Hello World <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sosleepy</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
